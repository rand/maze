
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Adaptive Constrained Code Generation - Compile constraints before decoding, not after">
      
      
      
        <link rel="canonical" href="https://rand.github.io/maze/whitepaper/whitepaper/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.svg">
      <meta name="generator" content="zensical-0.0.5">
    
    
      
        <title>MAZE: Adaptive Constrained Code Generation - MAZE</title>
      
    
    
      
        
      
      <link rel="stylesheet" href="../../assets/stylesheets/modern/main.1357c24d.min.css">
      
        
          
        
        <link rel="stylesheet" href="../../assets/stylesheets/modern/palette.dfe2e883.min.css">
      
      
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  
  <style>:root{}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Geist:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Geist";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/shared.css">
    
      <link rel="stylesheet" href="../../stylesheets/orange.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#maze-adaptive-constrained-code-generation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MAZE" class="md-header__button md-logo" aria-label="MAZE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-menu" viewBox="0 0 24 24"><path d="M4 5h16M4 12h16M4 19h16"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MAZE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MAZE: Adaptive Constrained Code Generation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-search" viewBox="0 0 24 24"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog" aria-label="Search">
  <button type="button" class="md-search__button">
    Search
  </button>
</div>
      
    
    <div class="md-header__source">
      
    </div>
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link">
        
  
  Whitepaper

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/rand/maze" class="md-tabs__link">
        
  
  GitHub

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MAZE" class="md-nav__button md-logo" aria-label="MAZE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>

    </a>
    MAZE
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Whitepaper
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/rand/maze" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abstract" class="md-nav__link">
    <span class="md-ellipsis">
      
        Abstract
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Introduction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-code-generation-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Code Generation Challenge
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mazes-paradigm-shift" class="md-nav__link">
    <span class="md-ellipsis">
      
        MAZE's Paradigm Shift
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#who-should-read-this" class="md-nav__link">
    <span class="md-ellipsis">
      
        Who Should Read This
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Document Structure
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Problem Statement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Problem Statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unconstrained-llm-generation-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unconstrained LLM Generation Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-cost-of-post-hoc-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Cost of Post-Hoc Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-errors-in-generated-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type Errors in Generated Code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-loss-in-large-codebases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Loss in Large Codebases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-need-for-constraint-first-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Need for Constraint-First Generation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Architecture Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-1-context-indexer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 1: Context Indexer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-constraint-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2: Constraint Synthesis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-3-decode-orchestrator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 3: Decode Orchestrator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-4-post-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 4: Post-Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-5-repair-loop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 5: Repair Loop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-4-tier-constraint-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. 4-Tier Constraint System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. 4-Tier Constraint System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tier-1-syntactic-constraints-cfg-grammars" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 1: Syntactic Constraints (CFG Grammars)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-2-type-constraints-inhabitation-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 2: Type Constraints (Inhabitation Search)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-3-semantic-constraints-test-driven" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 3: Semantic Constraints (Test-Driven)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-4-contextual-constraints-learned" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 4: Contextual Constraints (Learned)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constraint-composition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constraint Composition
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-type-directed-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Type-Directed Synthesis
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Type-Directed Synthesis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bidirectional-type-inference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bidirectional Type Inference
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-inhabitation-solver" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type Inhabitation Solver
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typed-hole-filling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Typed Hole Filling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-integration-ecosystem" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Integration Ecosystem
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Integration Ecosystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llguidance-constraint-enforcement" class="md-nav__link">
    <span class="md-ellipsis">
      
        llguidance: Constraint Enforcement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mnemosyne-persistent-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        mnemosyne: Persistent Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rune-sandboxed-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        RUNE: Sandboxed Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pedantic_raven-quality-enforcement" class="md-nav__link">
    <span class="md-ellipsis">
      
        pedantic_raven: Quality Enforcement
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-implementation-status-and-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Implementation Status and Roadmap
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Implementation Status and Roadmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-status-active-development" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Status: Active Development
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-1-3-core-system-complete" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1-3: Core System âœ… COMPLETE
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 1-3: Core System âœ… COMPLETE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-syntactic-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Syntactic Synthesis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Type System
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-validation-repair-in-progress-610-complete" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Validation &amp; Repair ðŸš§ IN PROGRESS (6/10 complete)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-adaptive-learning-planned" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Adaptive Learning ðŸ“‹ PLANNED
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-6-production-planned" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 6: Production ðŸ“‹ PLANNED
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-research-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Research Foundation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Research Foundation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-constrained-code-generation-pldi-2025" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type-Constrained Code Generation (PLDI 2025)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statically-contextualizing-llms-with-typed-holes-oopsla-2024" class="md-nav__link">
    <span class="md-ellipsis">
      
        Statically Contextualizing LLMs with Typed Holes (OOPSLA 2024)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llguidance-constraint-enforcement-for-llms" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLGuidance: Constraint Enforcement for LLMs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Work
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-architecture-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Architecture Validation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Architecture Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Statistics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Verification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-commit-history" class="md-nav__link">
    <span class="md-ellipsis">
      
        Git Commit History
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note-on-performance-claims" class="md-nav__link">
    <span class="md-ellipsis">
      
        Note on Performance Claims
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Getting Started
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Getting Started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-usage-conceptual" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage (Conceptual)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Conclusion
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-of-contributions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary of Contributions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#current-state-solid-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current State: Solid Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#future-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Work
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invitation-to-contribute" class="md-nav__link">
    <span class="md-ellipsis">
      
        Invitation to Contribute
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Acknowledgments
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. Resources
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#project-links" class="md-nav__link">
    <span class="md-ellipsis">
      
        Project Links
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#research-papers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Research Papers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related-projects" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Projects
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#community" class="md-nav__link">
    <span class="md-ellipsis">
      
        Community
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  

<h1 id="maze-adaptive-constrained-code-generation">MAZE: Adaptive Constrained Code Generation<a class="headerlink" href="#maze-adaptive-constrained-code-generation" title="Permanent link">&para;</a></h1>
<p><strong>A Research-Backed System for Type-Correct, Semantically Sound Code Generation</strong></p>
<p><strong>Version</strong>: v0.1.0-whitepaper
<strong>Date</strong>: November 2025
<strong>Author</strong>: Rand Arete</p>
<hr />
<h2 id="abstract">Abstract<a class="headerlink" href="#abstract" title="Permanent link">&para;</a></h2>
<p>Large Language Models (LLMs) have demonstrated remarkable capabilities in code generation, yet they suffer from high error rates when generating complex, type-correct code. Unconstrained generation often produces syntactically valid but semantically incorrect or type-unsafe code, requiring expensive post-hoc validation and multiple repair iterations.</p>
<p>MAZE introduces a paradigm shift: <strong>compile constraints before decoding, rather than hoping for correctness after generation</strong>. Through a novel 4-tier constraint hierarchyâ€”syntactic (CFG grammars), type (inhabitation search), semantic (test-driven), and contextual (learned patterns)â€”MAZE guides LLM generation toward valid, type-correct, and project-conform</p>
<p>ant code from the start.</p>
<p>Built on research from PLDI 2025 (Type-Constrained Code Generation) and OOPSLA 2024 (Typed Holes), MAZE integrates with multiple LLM providers (OpenAI, vLLM, SGLang, llama.cpp) through llguidance for constraint enforcement, mnemosyne for persistent learning, and RUNE for sandboxed validation.</p>
<p><strong>Current status</strong>: Core constraint system complete (Phases 1-3), validation pipeline in active development (Phase 4: 6/10 tasks complete), with adaptive learning and production hardening planned (Phases 5-6).</p>
<p><strong>Significance</strong>: MAZE demonstrates that formal constraint enforcement can be integrated with modern LLMs without sacrificing generation speed, providing a foundation for the next generation of AI-assisted development tools.</p>
<hr />
<h2 id="1-introduction">1. Introduction<a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<h3 id="the-code-generation-challenge">The Code Generation Challenge<a class="headerlink" href="#the-code-generation-challenge" title="Permanent link">&para;</a></h3>
<p>Large Language Models have revolutionized software development assistance, enabling developers to generate substantial code from natural language descriptions. However, this capability comes with a fundamental limitation: without explicit constraints, LLMs generate code based solely on statistical patterns learned from training data. This approach produces code that is often:</p>
<ul>
<li><strong>Syntactically plausible</strong> but incorrect</li>
<li><strong>Type-unsafe</strong>, causing compilation failures</li>
<li><strong>Semantically wrong</strong>, failing to implement the specified behavior</li>
<li><strong>Inconsistent</strong> with project conventions and patterns</li>
</ul>
<p>The standard approachâ€”generate freely, then validate and fix errors iterativelyâ€”wastes computational resources and developer time. Each iteration requires full re-generation, re-validation, and context management, creating an inefficient feedback loop.</p>
<h3 id="mazes-paradigm-shift">MAZE's Paradigm Shift<a class="headerlink" href="#mazes-paradigm-shift" title="Permanent link">&para;</a></h3>
<p>MAZE reverses this paradigm. Instead of hoping the LLM generates correct code, MAZE <strong>compiles constraints before token generation</strong>, guiding the model toward valid outputs from the start. This shift transforms the generation process:</p>
<p><strong>Traditional Approach</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Generate (unconstrained) â†’ Validate â†’ Find errors â†’ Fix â†’ Repeat
</span></code></pre></div></p>
<p><strong>MAZE Approach</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Build constraints â†’ Generate (constrained) â†’ Minimal validation â†’ Done
</span></code></pre></div></p>
<p>By enforcing constraints during decoding rather than after generation, MAZE reduces error rates, minimizes repair iterations, and produces higher-quality code with less computational overhead.</p>
<h3 id="architecture-foundation">Architecture Foundation<a class="headerlink" href="#architecture-foundation" title="Permanent link">&para;</a></h3>
<p>MAZE is built on four key innovations:</p>
<ol>
<li><strong>4-Tier Constraint Hierarchy</strong>: Progressive constraint tightening from syntax through types, semantics, and context</li>
<li><strong>Type-Directed Synthesis</strong>: Bidirectional type inference and inhabitation search for type-correct code paths</li>
<li><strong>Multi-System Integration</strong>: Seamless integration with llguidance, mnemosyne, RUNE, and pedantic_raven</li>
<li><strong>Provider Agnosticism</strong>: Support for OpenAI, vLLM, SGLang, and llama.cpp through unified adapters</li>
</ol>
<h3 id="who-should-read-this">Who Should Read This<a class="headerlink" href="#who-should-read-this" title="Permanent link">&para;</a></h3>
<p>This whitepaper is for:</p>
<ul>
<li><strong>Developers</strong> building AI-assisted development tools</li>
<li><strong>Researchers</strong> working on constrained generation and program synthesis</li>
<li><strong>AI Engineers</strong> integrating LLMs with formal methods</li>
<li><strong>Engineering Managers</strong> evaluating code generation technologies</li>
</ul>
<p>We assume familiarity with language models, type systems, and software engineering practices.</p>
<h3 id="document-structure">Document Structure<a class="headerlink" href="#document-structure" title="Permanent link">&para;</a></h3>
<p>The remainder of this whitepaper proceeds as follows:</p>
<ul>
<li><strong>Section 2</strong>: Problem statement and motivation</li>
<li><strong>Section 3</strong>: MAZE architecture overview</li>
<li><strong>Sections 4-6</strong>: Deep dive into constraint system, type synthesis, and integrations</li>
<li><strong>Sections 7-8</strong>: Implementation status and research foundation</li>
<li><strong>Sections 9-11</strong>: Validation, getting started, and conclusion</li>
</ul>
<hr />
<h2 id="2-problem-statement">2. Problem Statement<a class="headerlink" href="#2-problem-statement" title="Permanent link">&para;</a></h2>
<h3 id="unconstrained-llm-generation-failures">Unconstrained LLM Generation Failures<a class="headerlink" href="#unconstrained-llm-generation-failures" title="Permanent link">&para;</a></h3>
<p>Consider a request to generate a TypeScript function:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>&quot;Create an async function that fetches a user by ID and returns their email&quot;
</span></code></pre></div>
<p>An unconstrained LLM might generate:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUserEmail</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchUser</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>This code has multiple issues:</p>
<ol>
<li><strong>Missing type annotations</strong>: Parameters and return type unspecified</li>
<li><strong>Type safety violation</strong>: <code>user</code> might be <code>null</code> or <code>undefined</code></li>
<li><strong>Incomplete error handling</strong>: Network failures unhandled</li>
<li><strong>Contextual mismatch</strong>: May not match project's error handling patterns</li>
</ol>
<p>Each issue requires detection, diagnosis, and repairâ€”often through multiple LLM calls, consuming tokens and time.</p>
<h3 id="the-cost-of-post-hoc-validation">The Cost of Post-Hoc Validation<a class="headerlink" href="#the-cost-of-post-hoc-validation" title="Permanent link">&para;</a></h3>
<p>Post-generation validation creates a costly feedback loop:</p>
<p><strong>Iteration 1</strong>: Generate code â†’ Compile â†’ Find type errors â†’ Prompt for fixes
<strong>Iteration 2</strong>: Generate fixes â†’ Compile â†’ Find new errors â†’ Prompt again
<strong>Iteration 3</strong>: Generate fixes â†’ Compile â†’ Test â†’ Find semantic errors â†’ Prompt again
<strong>...</strong></p>
<p>In practice, research shows unconstrained generation often requires 3-5 iterations before producing working code. Each iteration:</p>
<ul>
<li>Consumes LLM API calls (cost)</li>
<li>Increases latency (time)</li>
<li>Risks context window overflow (technical limitation)</li>
<li>Frustrates developers (usability)</li>
</ul>
<h3 id="type-errors-in-generated-code">Type Errors in Generated Code<a class="headerlink" href="#type-errors-in-generated-code" title="Permanent link">&para;</a></h3>
<p>Type errors are particularly problematic because they cascade. A single type mismatch can cause:</p>
<ul>
<li><strong>Compilation failures</strong> blocking all downstream work</li>
<li><strong>Silent bugs</strong> when type coercion hides errors</li>
<li><strong>Integration failures</strong> when code doesn't match API contracts</li>
<li><strong>Maintenance burden</strong> as type-unsafe code spreads through the codebase</li>
</ul>
<p>Research by MÃ¼ndler et al. (PLDI 2025) found that unconstrained LLMs produce type errors in over 50% of generated functions for typed languages like TypeScript and Rust.</p>
<h3 id="context-loss-in-large-codebases">Context Loss in Large Codebases<a class="headerlink" href="#context-loss-in-large-codebases" title="Permanent link">&para;</a></h3>
<p>Real-world code generation occurs within existing codebases with:</p>
<ul>
<li><strong>Existing type hierarchies</strong> (classes, interfaces, type aliases)</li>
<li><strong>Project conventions</strong> (naming, error handling, async patterns)</li>
<li><strong>Available functions</strong> (APIs, utilities, helpers)</li>
<li><strong>Imported dependencies</strong> (libraries, frameworks)</li>
</ul>
<p>Unconstrained LLMs cannot reliably leverage this context because:</p>
<ol>
<li>Context must fit in LLM's input window (limited)</li>
<li>LLM has no semantic understanding of types (statistical only)</li>
<li>LLM cannot enumerate valid type paths (no formal reasoning)</li>
<li>LLM cannot verify constraints incrementally (post-hoc validation only)</li>
</ol>
<h3 id="the-need-for-constraint-first-generation">The Need for Constraint-First Generation<a class="headerlink" href="#the-need-for-constraint-first-generation" title="Permanent link">&para;</a></h3>
<p>These challenges point to a fundamental requirement: <strong>constraints must be enforced during generation, not after</strong>.</p>
<p>MAZE addresses this through:</p>
<ul>
<li><strong>Syntactic constraints</strong>: CFG grammars ensure valid syntax from the start</li>
<li><strong>Type constraints</strong>: Type inhabitation search finds valid type paths before generation</li>
<li><strong>Semantic constraints</strong>: Test-driven properties guide behavior</li>
<li><strong>Contextual constraints</strong>: Learned patterns enforce project consistency</li>
</ul>
<p>By compiling these constraints into the generation process, MAZE produces code that is correct-by-construction rather than correct-after-iteration.</p>
<hr />
<h2 id="3-architecture-overview">3. Architecture Overview<a class="headerlink" href="#3-architecture-overview" title="Permanent link">&para;</a></h2>
<p>MAZE's architecture consists of five integrated stages that transform a code generation request into validated, type-correct code:</p>
<p><img alt="MAZE Pipeline" src="../assets/diagrams/01-pipeline.svg" /></p>
<h3 id="stage-1-context-indexer">Stage 1: Context Indexer<a class="headerlink" href="#stage-1-context-indexer" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Extract structured information from source code to inform constraint synthesis</p>
<p><strong>Input</strong>: Source code files from the target project
<strong>Output</strong>: Symbols, type signatures, patterns, and project conventions</p>
<p><strong>Current Implementation</strong>:
- <strong>TypeScript Indexer</strong> âœ… Complete (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/indexer/languages/typescript.py">source</a>)
  - Extracts functions, classes, interfaces, type aliases
  - Parses type annotations and generic parameters
  - Detects project style (indentation, quotes, semicolons)
  - Identifies test patterns (Jest, Mocha, Vitest)</p>
<p><strong>Planned</strong>: Python, Rust, Go, Zig indexers</p>
<p><strong>Technical Approach</strong>:
- tree-sitter parsing for fast AST extraction
- Optional LSP integration (tsserver) for enhanced type information
- Symbol database for efficient lookup</p>
<p><strong>Example Output</strong> (simplified):
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;functions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fetchUser&quot;</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">      </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">}],</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">      </span><span class="nt">&quot;returns&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Promise&lt;User | null&gt;&quot;</span><span class="p">,</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">      </span><span class="nt">&quot;async&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span><span class="nt">&quot;types&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User&quot;</span><span class="p">,</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">      </span><span class="nt">&quot;kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;interface&quot;</span><span class="p">,</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">        </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">},</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">        </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">},</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">        </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">}</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">  </span><span class="nt">&quot;style&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="nt">&quot;indent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2 spaces&quot;</span><span class="p">,</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">    </span><span class="nt">&quot;quotes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;single&quot;</span><span class="p">,</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">    </span><span class="nt">&quot;semicolons&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="p">}</span>
</span></code></pre></div></p>
<h3 id="stage-2-constraint-synthesis">Stage 2: Constraint Synthesis<a class="headerlink" href="#stage-2-constraint-synthesis" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Build hierarchical constraints from indexed context and generation request</p>
<p><strong>Input</strong>: Indexed context + generation request
<strong>Output</strong>: 4-tier constraint set (syntactic, type, semantic, contextual)</p>
<p><strong>Components</strong>:</p>
<ol>
<li><strong>GrammarBuilder</strong> âœ… (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/synthesis/grammar_builder.py">source</a>)</li>
<li>Generates CFG grammars in Lark format</li>
<li>Language-specific templates (TypeScript, Python, Rust)</li>
<li>
<p>Composable grammar rules for functions, classes, expressions</p>
</li>
<li>
<p><strong>TypeToGrammarConverter</strong> âœ… (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/grammar_converter.py">source</a>)</p>
</li>
<li>Converts type constraints into grammar constraints</li>
<li>Implements type inhabitation search results as grammar rules</li>
<li>
<p>Integrates with llguidance for efficient enforcement</p>
</li>
<li>
<p><strong>SchemaBuilder</strong> âœ… (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/synthesis/schema_builder.py">source</a>)</p>
</li>
<li>Generates JSON Schema for structured output (OpenAI compatibility)</li>
<li>Translates CFG grammars to JSON Schema where possible</li>
<li>Fallback for providers without full CFG support</li>
</ol>
<p><strong>Example Constraint</strong> (TypeScript async function):
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>?start: async_function
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>async_function: &quot;async&quot; &quot;function&quot; IDENT params ret_type block
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>params: &quot;(&quot; [param (&quot;,&quot; param)*] &quot;)&quot;
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>param: IDENT &quot;:&quot; type_annotation
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>ret_type: &quot;:&quot; &quot;Promise&quot; &quot;&lt;&quot; type_annotation &quot;&gt;&quot;
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>type_annotation: &quot;User&quot; | &quot;null&quot; | &quot;User&quot; &quot;|&quot; &quot;null&quot;
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>block: &quot;{&quot; statement* &quot;}&quot;
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>IDENT: /[a-zA-Z_$][a-zA-Z0-9_$]*/
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>%ignore /\s+/
</span></code></pre></div></p>
<h3 id="stage-3-decode-orchestrator">Stage 3: Decode Orchestrator<a class="headerlink" href="#stage-3-decode-orchestrator" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Generate code under constraints using provider-specific adapters</p>
<p><strong>Input</strong>: Constraint set + generation prompt
<strong>Output</strong>: Generated code conforming to all constraints</p>
<p><strong>Integration</strong>: llguidance for fast constraint enforcement</p>
<p><strong>Provider Adapters</strong> âœ… (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/orchestrator/providers/">source</a>):</p>
<ul>
<li><strong>OpenAI</strong>: JSON Schema mode via structured outputs</li>
<li><strong>vLLM</strong>: Full CFG grammar support</li>
<li><strong>SGLang</strong>: Native llguidance integration</li>
<li><strong>llama.cpp</strong>: Grammar-based generation</li>
</ul>
<p><strong>Key Technical Challenge</strong>: Token-level constraint enforcement</p>
<p>llguidance computes which tokens are valid at each decode step based on the current grammar state. This requires:</p>
<ol>
<li><strong>Grammar automaton</strong>: Precomputed from CFG</li>
<li><strong>Tokenizer alignment</strong>: Grammar states aligned with LLM tokenizer</li>
<li><strong>Mask computation</strong>: Binary mask over vocabulary at each step</li>
<li><strong>Caching</strong>: Memoization of grammar state transitions</li>
</ol>
<p><strong>Upstream Performance</strong> (Microsoft Research): ~50Î¼s per token mask computation</p>
<p><strong>Process</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>For each token position:
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  1. Determine current grammar state
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  2. Compute valid next tokens (mask)
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>  3. Apply mask to LLM logits
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>  4. Sample from constrained distribution
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  5. Update grammar state
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>  6. Repeat until EOS or max length
</span></code></pre></div></p>
<h3 id="stage-4-post-validation">Stage 4: Post-Validation<a class="headerlink" href="#stage-4-post-validation" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Validate generated code across multiple dimensions in parallel</p>
<p><strong>Input</strong>: Generated code
<strong>Output</strong>: Validation results with diagnostics</p>
<p><strong>Validators</strong> (parallel execution):</p>
<ol>
<li><strong>SyntaxValidator</strong> âœ… Complete (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/syntax.py">source</a>)</li>
<li>Language-specific syntax checking</li>
<li>Parse tree validation</li>
<li>
<p>Fast failure detection</p>
</li>
<li>
<p><strong>TypeValidator</strong> âœ… Complete (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/types.py">source</a>)</p>
</li>
<li>Type checking via language-specific tools</li>
<li>TypeScript: via TypeScript compiler API</li>
<li>Python (planned): via mypy or Pyright</li>
<li>
<p>Rust (planned): via rust-analyzer</p>
</li>
<li>
<p><strong>TestValidator</strong> âœ… Complete (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/tests.py">source</a>)</p>
</li>
<li>Executes tests in RUNE sandbox</li>
<li>Behavioral validation</li>
<li>
<p>Property-based testing support</p>
</li>
<li>
<p><strong>LintValidator</strong> âœ… Complete (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/lint.py">source</a>)</p>
</li>
<li>Style checking (ESLint, Ruff, Clippy)</li>
<li>Code quality metrics</li>
<li>Convention adherence</li>
</ol>
<p><strong>ValidationPipeline</strong> âœ… Complete (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/pipeline.py">source</a>)
- Orchestrates parallel validation
- Aggregates diagnostics
- Determines overall pass/fail status</p>
<h3 id="stage-5-repair-loop">Stage 5: Repair Loop<a class="headerlink" href="#stage-5-repair-loop" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Refine constraints and regenerate if validation fails</p>
<p><strong>Status</strong>: ðŸ“‹ Planned (Phase 4)</p>
<p><strong>Planned Components</strong>:
- RepairOrchestrator: Manages repair iterations
- DiagnosticAnalyzer: Interprets validation failures
- ConstraintRefinement: Tightens constraints based on diagnostics
- Max 3 repair attempts with exponential backoff</p>
<p><strong>Repair Strategy</strong> (planned):
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>If validation fails:
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  1. Analyze diagnostics (which tier failed?)
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  2. Tighten appropriate constraint tier:
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>     - Syntax error â†’ Refine grammar
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>     - Type error â†’ Add type constraints
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>     - Semantic error â†’ Add test constraints
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>  3. Regenerate with refined constraints
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>  4. Validate again
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>  5. Repeat (max 3 times)
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>  6. If still failing â†’ Return partial with diagnostics
</span></code></pre></div></p>
<h3 id="integration-flow">Integration Flow<a class="headerlink" href="#integration-flow" title="Permanent link">&para;</a></h3>
<p>MAZE integrates with four external systems:</p>
<p><img alt="Integration Ecosystem" src="../assets/diagrams/04-integration-ecosystem.svg" /></p>
<ol>
<li><strong>llguidance</strong> (Microsoft Research): Constraint enforcement during decoding</li>
<li><strong>mnemosyne</strong>: Persistent memory for pattern learning across sessions</li>
<li><strong>RUNE</strong>: Sandboxed execution for safe test validation</li>
<li><strong>pedantic_raven</strong>: Deep semantic validation (planned integration)</li>
</ol>
<p>These integrations enable MAZE to:
- Enforce constraints efficiently (llguidance)
- Learn from past generations (mnemosyne)
- Validate safely (RUNE)
- Check deep properties (pedantic_raven)</p>
<hr />
<h2 id="4-4-tier-constraint-system">4. 4-Tier Constraint System<a class="headerlink" href="#4-4-tier-constraint-system" title="Permanent link">&para;</a></h2>
<p>MAZE's core innovation is a hierarchical constraint system that progressively narrows the space of valid programs:</p>
<p><img alt="4-Tier Constraint Hierarchy" src="../assets/diagrams/02-constraint-hierarchy.svg" /></p>
<h3 id="tier-1-syntactic-constraints-cfg-grammars">Tier 1: Syntactic Constraints (CFG Grammars)<a class="headerlink" href="#tier-1-syntactic-constraints-cfg-grammars" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Ensure generated code is syntactically valid</p>
<p><strong>Implementation</strong>: Context-Free Grammars (CFG) in Lark format</p>
<p><strong>Status</strong>: âœ… Complete for TypeScript, partial for Python/Rust</p>
<p><strong>Technical Approach</strong>:</p>
<p>CFG grammars define the valid structure of code at the syntactic level. MAZE uses Lark extended syntax for expressiveness:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>// TypeScript function grammar
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>?start: typescript_function
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>typescript_function: [&quot;export&quot;] [&quot;async&quot;] &quot;function&quot; IDENT params [ret_type] block
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>params: &quot;(&quot; [param_list] &quot;)&quot;
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>param_list: param (&quot;,&quot; param)*
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>param: IDENT [&quot;:&quot; type_annotation] [&quot;=&quot; expression]
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>ret_type: &quot;:&quot; type_annotation
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>type_annotation: base_type | union_type | array_type | generic_type
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>base_type: &quot;string&quot; | &quot;number&quot; | &quot;boolean&quot; | &quot;void&quot; | IDENT
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>union_type: type_annotation (&quot;|&quot; type_annotation)+
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>array_type: type_annotation &quot;[]&quot;
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>generic_type: IDENT &quot;&lt;&quot; type_annotation (&quot;,&quot; type_annotation)* &quot;&gt;&quot;
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>block: &quot;{&quot; statement* &quot;}&quot;
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>statement: variable_decl
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>         | assignment
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>         | return_stmt
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>         | if_stmt
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>         | for_stmt
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>         | expression_stmt
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>// ... additional rules ...
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>IDENT: /[a-zA-Z_$][a-zA-Z0-9_$]*/
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>%ignore /\s+/
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>%ignore /\/\/[^\n]*/  // Single-line comments
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>%ignore /\/\*(.|\n)*?\*\//  // Multi-line comments
</span></code></pre></div>
<p><strong>Benefits</strong>:
- <strong>Guaranteed syntactic validity</strong>: Generated code always parses
- <strong>Language-aware generation</strong>: LLM respects language syntax rules
- <strong>Composability</strong>: Grammars can be combined and extended</p>
<p><strong>Limitations</strong>:
- Does not guarantee semantic correctness
- Cannot express type constraints directly
- Limited to context-free languages (no context-sensitive rules)</p>
<h3 id="tier-2-type-constraints-inhabitation-search">Tier 2: Type Constraints (Inhabitation Search)<a class="headerlink" href="#tier-2-type-constraints-inhabitation-search" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Ensure generated code is type-correct</p>
<p><strong>Implementation</strong>: Type inhabitation solver + type-to-grammar conversion</p>
<p><strong>Status</strong>: âœ… Complete (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/">source</a>)</p>
<p><strong>Research Foundation</strong>: MÃ¼ndler et al., "Type-Constrained Code Generation" (PLDI 2025, arXiv:2504.09246)</p>
<p><strong>Key Concept</strong>: Type Inhabitation</p>
<p>Given a source type <code>S</code> and target type <code>T</code>, find valid transformation paths:</p>
<p><img alt="Type Inhabitation Example" src="../assets/diagrams/03-type-inhabitation.svg" /></p>
<p><strong>Example</strong>: Finding <code>User â†’ string</code> paths</p>
<p>Given:
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="nx">toString</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="p">}</span>
</span></code></pre></div></p>
<p>Valid paths:
1. <code>user.id</code> â†’ <code>string</code> âœ… (property access)
2. <code>user.name</code> â†’ <code>string</code> âœ… (property access)
3. <code>user.email</code> â†’ <code>string</code> âœ… (property access)
4. <code>user.toString()</code> â†’ <code>string</code> âœ… (method call)</p>
<p>Invalid paths:
- <code>user.age</code> â†’ <code>string</code> âŒ (type mismatch: number â†’ string)
- <code>user</code> â†’ <code>string</code> âŒ (no direct conversion)</p>
<p><strong>Type Inhabitation Algorithm</strong> (simplified):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">find_paths</span><span class="p">(</span><span class="n">source_type</span><span class="p">,</span> <span class="n">target_type</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find valid transformation paths from source to target type.&quot;&quot;&quot;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="k">if</span> <span class="n">source_type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">DirectPath</span><span class="p">()]</span>  <span class="c1"># Identity</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="k">if</span> <span class="n">max_depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        <span class="k">return</span> <span class="p">[]</span>  <span class="c1"># Search depth exceeded</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    <span class="c1"># Property access: source.property â†’ target</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">source_type</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PropertyPath</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>            <span class="c1"># Recursive search</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>            <span class="n">sub_paths</span> <span class="o">=</span> <span class="n">find_paths</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">target_type</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>            <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">PropertyPath</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">sub_paths</span><span class="p">])</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>    <span class="c1"># Method calls: source.method() â†’ target</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">source_type</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MethodPath</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>            <span class="n">sub_paths</span> <span class="o">=</span> <span class="n">find_paths</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">return_type</span><span class="p">,</span> <span class="n">target_type</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>            <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">MethodPath</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">sub_paths</span><span class="p">])</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>    <span class="c1"># Available functions: f(source) â†’ target</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>        <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">param_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">source_type</span> <span class="ow">and</span> <span class="n">func</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FunctionPath</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>    <span class="k">return</span> <span class="n">paths</span>
</span></code></pre></div>
<p><strong>Type-to-Grammar Conversion</strong>:</p>
<p>Once valid paths are found, they're converted to grammar rules:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>// For User â†’ string with paths: .id, .name, .email, .toString()
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>user_to_string: user &quot;.&quot; (&quot;id&quot; | &quot;name&quot; | &quot;email&quot;)
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>              | user &quot;.&quot; &quot;toString&quot; &quot;(&quot; &quot;)&quot;
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>user: IDENT  // Variable of type User
</span></code></pre></div>
<p><strong>Integration with llguidance</strong>:</p>
<p>These grammar constraints are compiled into prefix automata and enforced during decoding, ensuring the LLM only generates type-valid expressions.</p>
<p><strong>Benefits</strong>:
- <strong>Type safety</strong>: Generated code is type-correct by construction
- <strong>Error reduction</strong>: Eliminates type errors that plague unconstrained generation
- <strong>Contextual awareness</strong>: Leverages project's type hierarchy</p>
<p><strong>Limitations</strong>:
- Requires type information (typed languages only)
- Search space grows exponentially with depth (mitigated by memoization)
- Cannot express all type constraints (e.g., dependent types)</p>
<h3 id="tier-3-semantic-constraints-test-driven">Tier 3: Semantic Constraints (Test-Driven)<a class="headerlink" href="#tier-3-semantic-constraints-test-driven" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Ensure generated code implements specified behavior</p>
<p><strong>Implementation</strong>: Test cases + property specifications</p>
<p><strong>Status</strong>: âœ… Validators complete, orchestration planned</p>
<p><strong>Approach</strong>:</p>
<p>Semantic constraints are specified through:</p>
<ol>
<li><strong>Concrete test cases</strong>: Input/output examples</li>
<li><strong>Property-based constraints</strong>: Invariants that must hold</li>
</ol>
<p><strong>Example</strong>:</p>
<p>For a sorting function:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze.core.constraints</span><span class="w"> </span><span class="kn">import</span> <span class="n">SemanticConstraint</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">constraint</span> <span class="o">=</span> <span class="n">SemanticConstraint</span><span class="p">(</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="n">specification</span><span class="o">=</span><span class="s2">&quot;Sort array in ascending order&quot;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="p">)</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="c1"># Concrete test cases</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">constraint</span><span class="o">.</span><span class="n">add_test_case</span><span class="p">(</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="nb">input</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="n">expected_output</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="p">)</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="n">constraint</span><span class="o">.</span><span class="n">add_test_case</span><span class="p">(</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    <span class="nb">input</span><span class="o">=</span><span class="p">[],</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>    <span class="n">expected_output</span><span class="o">=</span><span class="p">[]</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="p">)</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="c1"># Properties (invariants)</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="n">constraint</span><span class="o">.</span><span class="n">add_property</span><span class="p">(</span><span class="s2">&quot;Output length equals input length&quot;</span><span class="p">)</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="n">constraint</span><span class="o">.</span><span class="n">add_property</span><span class="p">(</span><span class="s2">&quot;Output is sorted (output[i] &lt;= output[i+1])&quot;</span><span class="p">)</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="n">constraint</span><span class="o">.</span><span class="n">add_property</span><span class="p">(</span><span class="s2">&quot;Output contains same elements as input (multiset equality)&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Validation Process</strong>:</p>
<ol>
<li>Generate code under syntactic + type constraints</li>
<li>Execute test cases in RUNE sandbox (safe, isolated execution)</li>
<li>Verify properties hold across test cases</li>
<li>If failures detected, extract diagnostics and refine constraints</li>
</ol>
<p><strong>Integration with RUNE</strong>:</p>
<p>All test execution happens in RUNE sandboxes to ensure:
- Network isolation (no external calls)
- Filesystem isolation (temporary directory)
- Resource limits (CPU, memory, time)
- Deterministic execution (same input â†’ same output)</p>
<p><strong>Benefits</strong>:
- <strong>Behavioral correctness</strong>: Code does what it's supposed to do
- <strong>Specification-driven</strong>: Tests serve as executable specifications
- <strong>Safety</strong>: RUNE ensures generated code can't cause harm during testing</p>
<p><strong>Limitations</strong>:
- Requires test case creation (manual effort)
- Test coverage may be incomplete (edge cases missed)
- Execution overhead (slower than pure static checks)</p>
<h3 id="tier-4-contextual-constraints-learned">Tier 4: Contextual Constraints (Learned)<a class="headerlink" href="#tier-4-contextual-constraints-learned" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Ensure generated code matches project conventions and patterns</p>
<p><strong>Implementation</strong>: Pattern mining + mnemosyne integration</p>
<p><strong>Status</strong>: ðŸ“‹ Planned (Phase 5)</p>
<p><strong>Concept</strong>:</p>
<p>Projects have implicit conventions that go beyond syntax, types, and semantics:
- Naming conventions (camelCase, PascalCase, snake_case)
- Error handling patterns (try/catch, Result types, null checks)
- Async patterns (async/await vs. .then(), Promise usage)
- Import organization (alphabetical, grouped by source)
- Code structure (guard clauses, early returns)</p>
<p><strong>Planned Approach</strong>:</p>
<ol>
<li>
<p><strong>Pattern Mining</strong>: Analyze existing codebase to extract patterns
   <div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze.learning.pattern_miner</span><span class="w"> </span><span class="kn">import</span> <span class="n">PatternMiner</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">miner</span> <span class="o">=</span> <span class="n">PatternMiner</span><span class="p">()</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">patterns</span> <span class="o">=</span> <span class="k">await</span> <span class="n">miner</span><span class="o">.</span><span class="n">mine_patterns</span><span class="p">(</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">project_path</span><span class="o">=</span><span class="s2">&quot;./my-project&quot;</span><span class="p">,</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="n">language</span><span class="o">=</span><span class="s2">&quot;typescript&quot;</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="p">)</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="c1"># Extracted patterns:</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="c1"># - 95% of functions use async/await (not .then())</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="c1"># - 100% of files use single quotes</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="c1"># - 88% of functions have guard clauses for null checks</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="c1"># - 92% of error handling uses try/catch</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Soft Constraints</strong>: Weight patterns by frequency
   <div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze.core.constraints</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContextualConstraint</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">contextual</span> <span class="o">=</span> <span class="n">ContextualConstraint</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1"># Strong preference (95% prevalence)</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="n">contextual</span><span class="o">.</span><span class="n">add_pattern</span><span class="p">(</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;use async/await instead of .then()&quot;</span><span class="p">,</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="n">weight</span><span class="o">=</span><span class="mf">0.95</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="p">)</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="c1"># Weak preference (60% prevalence)</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="n">contextual</span><span class="o">.</span><span class="n">add_pattern</span><span class="p">(</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;use const over let&quot;</span><span class="p">,</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>    <span class="n">weight</span><span class="o">=</span><span class="mf">0.60</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Adaptive Learning</strong>: Update patterns based on success/failure
   <div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># After successful generation</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">await</span> <span class="n">memory</span><span class="o">.</span><span class="n">store_constraint_pattern</span><span class="p">(</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;async-error-handling&quot;</span><span class="p">,</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;compilation&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;tests_passed&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="p">)</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="c1"># After failed generation</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="k">await</span> <span class="n">memory</span><span class="o">.</span><span class="n">store_constraint_pattern</span><span class="p">(</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;promise-chaining&quot;</span><span class="p">,</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>    <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;compilation&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;type mismatch&quot;</span><span class="p">}</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="p">)</span>
</span></code></pre></div></p>
</li>
</ol>
<p><strong>Integration with mnemosyne</strong>:</p>
<p>mnemosyne provides persistent memory across sessions:
- Store successful patterns (what worked)
- Store failed patterns (what didn't work)
- Recall similar contexts for new generation tasks
- Update pattern weights based on long-term success rates</p>
<p><strong>Benefits</strong>:
- <strong>Project consistency</strong>: Generated code matches existing style
- <strong>Developer experience</strong>: Less manual refactoring needed
- <strong>Knowledge retention</strong>: Learning accumulates across sessions</p>
<p><strong>Limitations</strong>:
- Requires significant codebase for pattern mining
- Soft constraints (suggestions, not guarantees)
- May reinforce bad patterns if they're common in codebase</p>
<h3 id="constraint-composition">Constraint Composition<a class="headerlink" href="#constraint-composition" title="Permanent link">&para;</a></h3>
<p>The four tiers compose hierarchically:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Syntactic constraints (broadest)
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>  â†“ Narrows to syntactically valid programs
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Type constraints
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>  â†“ Narrows to type-correct programs
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>Semantic constraints
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>  â†“ Narrows to behaviorally correct programs
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>Contextual constraints
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>  â†“ Narrows to project-conformant programs
</span></code></pre></div>
<p>Each tier reduces the search space, progressively guiding the LLM toward the desired output.</p>
<hr />
<h2 id="5-type-directed-synthesis">5. Type-Directed Synthesis<a class="headerlink" href="#5-type-directed-synthesis" title="Permanent link">&para;</a></h2>
<p>Type-directed synthesis is MAZE's most sophisticated capability, enabling generation of type-correct code through formal type theory.</p>
<p><strong>Research Foundation</strong>: MÃ¼ndler et al. (PLDI 2025) and Blinn et al. (OOPSLA 2024)</p>
<h3 id="bidirectional-type-inference">Bidirectional Type Inference<a class="headerlink" href="#bidirectional-type-inference" title="Permanent link">&para;</a></h3>
<p>MAZE implements bidirectional type inference to propagate type information in both directions:</p>
<p><strong>Synthesis mode</strong> (bottom-up): Infer type of expression from sub-expressions
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>expression â†’ inferred_type
</span></code></pre></div></p>
<p><strong>Checking mode</strong> (top-down): Check if expression matches expected type
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>expression + expected_type â†’ pass/fail
</span></code></pre></div></p>
<p><strong>Example</strong>:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">// Synthesis: Infer type of function call</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fetchUser</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">);</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="c1">// Inferred: result : Promise&lt;User | null&gt;</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="c1">// Checking: Does return value match expected type?</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUserEmail</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchUser</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span><span class="w">  </span><span class="c1">// Check: User | null</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span><span class="w">  </span><span class="c1">// Check: string (but user might be null! â†’ Error)</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="type-inhabitation-solver">Type Inhabitation Solver<a class="headerlink" href="#type-inhabitation-solver" title="Permanent link">&para;</a></h3>
<p><strong>Implementation</strong>: <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/inhabitation.py">src/maze/type_system/inhabitation.py</a></p>
<p><strong>Purpose</strong>: Find expressions that inhabit (produce) a given type</p>
<p><strong>Algorithm</strong> (detailed):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">InhabitationSolver</span><span class="p">:</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Memoization for performance</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_inhabitants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">TypeContext</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all expressions that produce target_type.&quot;&quot;&quot;</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>        <span class="c1"># Check cache first</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_type</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>        <span class="n">inhabitants</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>        <span class="c1"># 1. Variables in scope with target type</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>                <span class="n">inhabitants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VariableExpr</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>        <span class="c1"># 2. Function calls that return target type</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>            <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>                <span class="c1"># Find inhabitants for each parameter</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>                <span class="n">param_inhabitants</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>                <span class="k">for</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">param_types</span><span class="p">:</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>                    <span class="n">param_inhab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_inhabitants</span><span class="p">(</span><span class="n">param_type</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">param_inhab</span><span class="p">:</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>                        <span class="k">break</span>  <span class="c1"># Can&#39;t inhabit this parameter</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>                    <span class="n">param_inhabitants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_inhab</span><span class="p">)</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_inhabitants</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">param_types</span><span class="p">):</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>                    <span class="c1"># Can call this function</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>                    <span class="k">for</span> <span class="n">param_combo</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">param_inhabitants</span><span class="p">):</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>                        <span class="n">inhabitants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FunctionCallExpr</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">param_combo</span><span class="p">))</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>        <span class="c1"># 3. Property access on available objects</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>                <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>                    <span class="n">inhabitants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PropertyAccessExpr</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>        <span class="c1"># 4. Method calls on available objects</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>                <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a>                    <span class="c1"># Similar parameter inhabitation logic as functions</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a>                    <span class="c1"># ...</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a>                    <span class="k">pass</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a>        <span class="c1"># 5. Constructors that create target type</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target_type</span><span class="p">,</span> <span class="s1">&#39;constructor&#39;</span><span class="p">):</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>            <span class="c1"># ...</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a>            <span class="k">pass</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a>        <span class="c1"># Cache and return</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">inhabitants</span>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a>        <span class="k">return</span> <span class="n">inhabitants</span>
</span></code></pre></div>
<p><strong>Optimization Techniques</strong>:</p>
<ol>
<li><strong>Memoization</strong>: Cache results to avoid redundant searches</li>
<li><strong>Depth limiting</strong>: Prevent infinite recursion (default: max_depth=5)</li>
<li><strong>Ranking</strong>: Prioritize simpler expressions (fewer steps)</li>
<li><strong>Pruning</strong>: Eliminate type-incompatible paths early</li>
</ol>
<h3 id="typed-hole-filling">Typed Hole Filling<a class="headerlink" href="#typed-hole-filling" title="Permanent link">&para;</a></h3>
<p><strong>Implementation</strong>: <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/holes.py">src/maze/type_system/holes.py</a></p>
<p><strong>Research Foundation</strong>: Blinn et al., "Statically Contextualizing LLMs with Typed Holes" (OOPSLA 2024, arXiv:2409.00921)</p>
<p><strong>Concept</strong>: Partial code with "holes" to be filled</p>
<p><strong>Example</strong>:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUserEmail</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchUser</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="cm">/*__HOLE__*/</span><span class="w">  </span><span class="c1">// What should we return here?</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="cm">/*__HOLE__*/</span><span class="p">;</span><span class="w">  </span><span class="c1">// What expression returns string from User?</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Hole Filling Process</strong>:</p>
<ol>
<li><strong>Detect hole markers</strong>: <code>/*__HOLE__*/</code> or similar</li>
<li><strong>Infer expected type</strong>: Analyze surrounding context</li>
<li>First hole: Inside <code>if</code> returning <code>Promise&lt;string&gt;</code> â†’ expect <code>string | Promise&lt;string&gt;</code></li>
<li>Second hole: Return statement in function returning <code>Promise&lt;string&gt;</code> â†’ expect <code>string</code></li>
<li><strong>Find inhabitants</strong>: Use inhabitation solver</li>
<li>First hole: Could return <code>""</code>, <code>throw new Error(...)</code>, etc.</li>
<li>Second hole: <code>user.email</code> (User has email: string property)</li>
<li><strong>Rank candidates</strong>: Prefer simpler, more direct expressions</li>
<li><strong>Generate completion</strong>: Fill hole with highest-ranked candidate</li>
</ol>
<p><strong>Integration with LLM</strong>:</p>
<p>Instead of asking the LLM to generate complete functions, MAZE can:
1. Generate partial code with typed holes
2. Use type inhabitation to find valid hole completions
3. Let LLM choose among valid candidates (constrained generation)</p>
<p>This hybrid approach combines LLM creativity with formal correctness guarantees.</p>
<hr />
<h2 id="6-integration-ecosystem">6. Integration Ecosystem<a class="headerlink" href="#6-integration-ecosystem" title="Permanent link">&para;</a></h2>
<p>MAZE integrates with four external systems, each providing complementary capabilities:</p>
<h3 id="llguidance-constraint-enforcement">llguidance: Constraint Enforcement<a class="headerlink" href="#llguidance-constraint-enforcement" title="Permanent link">&para;</a></h3>
<p><strong>Source</strong>: Microsoft Research, <a href="https://github.com/guidance-ai/llguidance">guidance-ai/llguidance</a></p>
<p><strong>Purpose</strong>: Efficient constraint enforcement during LLM decoding</p>
<p><strong>How it Works</strong>:</p>
<p>llguidance compiles CFG grammars into finite-state automata, then computes token-level masks during generation:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>Grammar (Lark) â†’ Automaton â†’ Token Masks â†’ Constrained Generation
</span></code></pre></div>
<p><strong>Performance</strong> (upstream benchmarks):
- Mask computation: ~50Î¼s per token (p99, 128k tokenizer)
- Grammar compilation: &lt;50ms for typical programming language grammars
- Memory overhead: ~10MB per grammar automaton</p>
<p><strong>MAZE Integration</strong>: <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/integrations/llguidance/">src/maze/integrations/llguidance/</a></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze.integrations.llguidance</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLGuidanceAdapter</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">adapter</span> <span class="o">=</span> <span class="n">LLGuidanceAdapter</span><span class="p">(</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="n">mask_cache_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>  <span class="c1"># LRU cache for mask reuse</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>    <span class="n">enable_profiling</span><span class="o">=</span><span class="kc">True</span>     <span class="c1"># Track performance metrics</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="p">)</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="c1"># Build parser from grammar</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="n">parser</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">build_parser</span><span class="p">(</span><span class="n">grammar_string</span><span class="p">)</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="c1"># During generation, compute masks</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">compute_mask</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">current_state</span><span class="p">)</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>    <span class="n">constrained_logits</span> <span class="o">=</span> <span class="n">apply_mask</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>    <span class="n">token</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">constrained_logits</span><span class="p">)</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>    <span class="n">current_state</span> <span class="o">=</span> <span class="n">update_state</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Benefits</strong>:
- Proven efficiency (Microsoft Research backing)
- Provider-agnostic (works with any transformer LLM)
- Actively maintained (regular updates)</p>
<h3 id="mnemosyne-persistent-memory">mnemosyne: Persistent Memory<a class="headerlink" href="#mnemosyne-persistent-memory" title="Permanent link">&para;</a></h3>
<p><strong>Source</strong>: <a href="https://github.com/rand/mnemosyne">rand/mnemosyne</a>, <a href="https://rand.github.io/mnemosyne">Documentation</a></p>
<p><strong>Purpose</strong>: Semantic memory and learning across sessions</p>
<p><strong>MAZE Use Cases</strong>:</p>
<ol>
<li>
<p><strong>Pattern Storage</strong>: Remember successful constraint patterns
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>mnemosyne<span class="w"> </span>remember<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span>-c<span class="w"> </span><span class="s2">&quot;TypeScript async function with Promise&lt;T&gt; return: 94% success&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">  </span>-n<span class="w"> </span><span class="s2">&quot;project:maze:constraint:typescript&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">  </span>-i<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span>-t<span class="w"> </span><span class="s2">&quot;constraint,typescript,async,success&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Context Recall</strong>: Retrieve relevant patterns for new tasks
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>mnemosyne<span class="w"> </span>recall<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span>-q<span class="w"> </span><span class="s2">&quot;async error handling patterns typescript&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span>-n<span class="w"> </span><span class="s2">&quot;project:maze:constraint:typescript&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span>-l<span class="w"> </span><span class="m">10</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Adaptive Learning</strong>: Update pattern weights based on outcomes
   <div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># After successful generation</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">await</span> <span class="n">memory</span><span class="o">.</span><span class="n">update_pattern_weight</span><span class="p">(</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="n">pattern_id</span><span class="o">=</span><span class="s2">&quot;async-error-handling&quot;</span><span class="p">,</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>    <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;compilation&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="p">)</span>
</span></code></pre></div></p>
</li>
</ol>
<p><strong>Integration</strong>: <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/integrations/mnemosyne/">src/maze/integrations/mnemosyne/</a></p>
<p><strong>Status</strong>: âœ… Basic integration complete, full adaptive learning planned (Phase 5)</p>
<h3 id="rune-sandboxed-execution">RUNE: Sandboxed Execution<a class="headerlink" href="#rune-sandboxed-execution" title="Permanent link">&para;</a></h3>
<p><strong>Source</strong>: <a href="https://github.com/rand/RUNE">rand/RUNE</a>, <a href="https://rand.github.io/RUNE">Documentation</a></p>
<p><strong>Purpose</strong>: Safe, isolated execution for test validation</p>
<p><strong>MAZE Use Cases</strong>:</p>
<ol>
<li><strong>Test Execution</strong>: Run generated code's tests without risk</li>
<li><strong>Property Verification</strong>: Check invariants hold</li>
<li><strong>Behavioral Validation</strong>: Ensure code does what it claims</li>
</ol>
<p><strong>Safety Guarantees</strong>:
- <strong>Network isolation</strong>: No external network access
- <strong>Filesystem isolation</strong>: Temporary directory, no access to host filesystem
- <strong>Resource limits</strong>: CPU, memory, and time quotas enforced
- <strong>Deterministic execution</strong>: Same input â†’ same output</p>
<p><strong>Integration</strong>: <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/integrations/rune/">src/maze/integrations/rune/</a></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze.integrations.rune</span><span class="w"> </span><span class="kn">import</span> <span class="n">RuneAdapter</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">rune</span> <span class="o">=</span> <span class="n">RuneAdapter</span><span class="p">()</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="c1"># Execute tests in sandbox</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rune</span><span class="o">.</span><span class="n">execute_tests</span><span class="p">(</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="n">code</span><span class="o">=</span><span class="n">generated_code</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    <span class="n">tests</span><span class="o">=</span><span class="n">specification</span><span class="o">.</span><span class="n">tests</span><span class="p">,</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>    <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>           <span class="c1"># 30 second limit</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>    <span class="n">memory_limit_mb</span><span class="o">=</span><span class="mi">512</span>   <span class="c1"># 512MB memory limit</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="p">)</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">passed</span><span class="p">:</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> tests passed&quot;</span><span class="p">)</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>    <span class="c1"># Extract diagnostics for repair loop</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>    <span class="n">failed_tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">success</span><span class="p">]</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>    <span class="n">diagnostics</span> <span class="o">=</span> <span class="n">extract_diagnostics</span><span class="p">(</span><span class="n">failed_tests</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Status</strong>: âœ… Complete integration via RuneExecutor</p>
<h3 id="pedantic_raven-quality-enforcement">pedantic_raven: Quality Enforcement<a class="headerlink" href="#pedantic_raven-quality-enforcement" title="Permanent link">&para;</a></h3>
<p><strong>Source</strong>: <a href="https://github.com/rand/pedantic_raven">rand/pedantic_raven</a></p>
<p><strong>Purpose</strong>: Deep semantic validation and code quality checks</p>
<p><strong>MAZE Use Cases</strong> (planned):</p>
<ol>
<li><strong>Semantic Property Validation</strong>: Beyond test cases</li>
<li><strong>Code Quality Metrics</strong>: Complexity, maintainability</li>
<li><strong>Best Practice Enforcement</strong>: Language-specific idioms</li>
</ol>
<p><strong>Status</strong>: ðŸ“‹ Placeholder exists, full integration planned (Phase &#8536;)</p>
<hr />
<h2 id="7-implementation-status-and-roadmap">7. Implementation Status and Roadmap<a class="headerlink" href="#7-implementation-status-and-roadmap" title="Permanent link">&para;</a></h2>
<h3 id="current-status-active-development">Current Status: Active Development<a class="headerlink" href="#current-status-active-development" title="Permanent link">&para;</a></h3>
<p>MAZE has completed its core architectural foundation (Phases 1-3) and is actively building the validation and repair pipeline (Phase 4).</p>
<p><strong>Timeline</strong>:
- <strong>Phase 1</strong> (Complete): November 2025 - Foundation
- <strong>Phase 2</strong> (Complete): November 2025 - Syntactic Constraints
- <strong>Phase 3</strong> (Complete): November 2025 - Type System
- <strong>Phase 4</strong> (In Progress): November-December 2025 - Validation &amp; Repair
- <strong>Phase 5</strong> (Planned): Q1 2026 - Adaptive Learning
- <strong>Phase 6</strong> (Planned): Q2 2026 - Production</p>
<p><img alt="Roadmap" src="../assets/diagrams/06-roadmap.svg" /></p>
<h3 id="phase-1-3-core-system-complete">Phase 1-3: Core System âœ… COMPLETE<a class="headerlink" href="#phase-1-3-core-system-complete" title="Permanent link">&para;</a></h3>
<p><strong>10,847 lines of code across 43 source files</strong></p>
<h4 id="phase-1-foundation">Phase 1: Foundation<a class="headerlink" href="#phase-1-foundation" title="Permanent link">&para;</a></h4>
<ul>
<li>âœ… Core type system (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/core/types.py">types.py</a>)</li>
<li>âœ… Constraint abstractions (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/core/constraints.py">constraints.py</a>)</li>
<li>âœ… llguidance integration (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/integrations/llguidance/">integrations/llguidance/</a>)</li>
<li>âœ… TypeScript indexer (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/indexer/languages/typescript.py">indexer/languages/typescript.py</a>)</li>
<li>âœ… Test infrastructure (29 test files)</li>
</ul>
<h4 id="phase-2-syntactic-synthesis">Phase 2: Syntactic Synthesis<a class="headerlink" href="#phase-2-syntactic-synthesis" title="Permanent link">&para;</a></h4>
<ul>
<li>âœ… Grammar builder (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/synthesis/grammar_builder.py">synthesis/grammar_builder.py</a>)</li>
<li>âœ… JSON Schema builder (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/synthesis/schema_builder.py">synthesis/schema_builder.py</a>)</li>
<li>âœ… Provider adapters (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/orchestrator/providers/">orchestrator/providers/</a>)</li>
<li>âœ… Language grammars: TypeScript (complete), Python/Rust (partial)</li>
</ul>
<h4 id="phase-3-type-system">Phase 3: Type System<a class="headerlink" href="#phase-3-type-system" title="Permanent link">&para;</a></h4>
<p><strong>2,124 lines dedicated to type system</strong></p>
<ul>
<li>âœ… Type inference engine (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/inference.py">type_system/inference.py</a>)</li>
<li>âœ… Type inhabitation solver (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/inhabitation.py">type_system/inhabitation.py</a>)</li>
<li>âœ… Typed holes (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/holes.py">type_system/holes.py</a>)</li>
<li>âœ… Type-to-grammar converter (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/grammar_converter.py">type_system/grammar_converter.py</a>)</li>
<li>âœ… TypeScript type system (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/languages/typescript.py">type_system/languages/typescript.py</a>)</li>
</ul>
<p><strong>Git Commit</strong>: a3fad53 - "chore: Sync Beads state after Phase 3 completion"</p>
<h3 id="phase-4-validation-repair-in-progress-610-complete">Phase 4: Validation &amp; Repair ðŸš§ IN PROGRESS (6/10 complete)<a class="headerlink" href="#phase-4-validation-repair-in-progress-610-complete" title="Permanent link">&para;</a></h3>
<p><strong>Recent Progress</strong> (as of November 8, 2025):</p>
<p>âœ… <strong>Complete Components</strong>:
1. SyntaxValidator (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/syntax.py">validation/syntax.py</a>) - Commit 013846c
2. TypeValidator (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/types.py">validation/types.py</a>) - Commit a1b463c
3. TestValidator (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/tests.py">validation/tests.py</a>) - Commit 3f8f006
4. LintValidator (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/lint.py">validation/lint.py</a>) - Commit 7a91e04
5. RuneExecutor (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/integrations/rune/">integrations/rune/</a>) - Commit 0e358b4
6. ValidationPipeline (<a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/pipeline.py">validation/pipeline.py</a>) - Commit b4b31c6</p>
<p>ðŸ“‹ <strong>Remaining Tasks</strong>:
- RepairOrchestrator: Manages repair iteration logic
- DiagnosticAnalyzer: Interprets validation failures
- ConstraintRefinement: Tightens constraints based on diagnostics
- Full pedantic_raven integration: Deep semantic validation</p>
<p><strong>Expected Completion</strong>: December 2025</p>
<h3 id="phase-5-adaptive-learning-planned">Phase 5: Adaptive Learning ðŸ“‹ PLANNED<a class="headerlink" href="#phase-5-adaptive-learning-planned" title="Permanent link">&para;</a></h3>
<p><strong>Timeline</strong>: Q1 2026</p>
<p><strong>Components</strong>:
- Pattern mining from existing codebases
- Constraint learning from generation outcomes
- Full mnemosyne integration for persistent learning
- Project-specific pattern adaptation
- Success rate tracking and weight adjustment</p>
<p><strong>Goal</strong>: Learn project conventions and improve over time</p>
<h3 id="phase-6-production-planned">Phase 6: Production ðŸ“‹ PLANNED<a class="headerlink" href="#phase-6-production-planned" title="Permanent link">&para;</a></h3>
<p><strong>Timeline</strong>: Q2 2026</p>
<p><strong>Components</strong>:
- Performance optimization (speculative decoding, parallelization)
- Multi-language indexers (Python, Rust, Go, Zig completion)
- IDE integrations (VSCode, IntelliJ plugins)
- Comprehensive benchmarking:
  - HumanEval (164 Python problems)
  - MBPP (974 Python problems with types)
  - SWE-bench-lite (real-world bug fixes)
- Production deployment guides
- Stability and reliability hardening</p>
<p><strong>Goal</strong>: Production-ready system with proven benchmarks</p>
<hr />
<h2 id="8-research-foundation">8. Research Foundation<a class="headerlink" href="#8-research-foundation" title="Permanent link">&para;</a></h2>
<p>MAZE builds on established research in constrained generation, program synthesis, and type theory:</p>
<h3 id="type-constrained-code-generation-pldi-2025">Type-Constrained Code Generation (PLDI 2025)<a class="headerlink" href="#type-constrained-code-generation-pldi-2025" title="Permanent link">&para;</a></h3>
<p><strong>Paper</strong>: MÃ¼ndler et al., "Type-Constrained Code Generation with Language Models"
<strong>Venue</strong>: PLDI 2025
<strong>arXiv</strong>: <a href="https://arxiv.org/abs/2504.09246">2504.09246</a></p>
<p><strong>Key Contributions</strong>:
1. Type constraints as prefix automata
2. Bidirectional type inference for LLM guidance
3. Reported &gt;50% reduction in compilation errors</p>
<p><strong>MAZE Implementation</strong>:
- Type inhabitation solver implements similar search algorithm
- Type-to-grammar conversion enables llguidance integration
- Architecture designed to support reported error reduction</p>
<p><strong>Status</strong>: Core algorithms implemented, benchmarking pending</p>
<h3 id="statically-contextualizing-llms-with-typed-holes-oopsla-2024">Statically Contextualizing LLMs with Typed Holes (OOPSLA 2024)<a class="headerlink" href="#statically-contextualizing-llms-with-typed-holes-oopsla-2024" title="Permanent link">&para;</a></h3>
<p><strong>Paper</strong>: Blinn et al., "Statically Contextualizing Large Language Models with Typed Holes"
<strong>Venue</strong>: OOPSLA 2024
<strong>arXiv</strong>: <a href="https://arxiv.org/abs/2409.00921">2409.00921</a></p>
<p><strong>Key Contributions</strong>:
1. Typed holes for partial code completion
2. Static context extraction for LLM guidance
3. Evaluation on real-world TypeScript codebases</p>
<p><strong>MAZE Implementation</strong>:
- Typed hole filling module: <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/holes.py">type_system/holes.py</a>
- Hole marker detection and context extraction
- Type inhabitation for hole completion</p>
<p><strong>Status</strong>: Implementation complete based on paper methodology</p>
<h3 id="llguidance-constraint-enforcement-for-llms">LLGuidance: Constraint Enforcement for LLMs<a class="headerlink" href="#llguidance-constraint-enforcement-for-llms" title="Permanent link">&para;</a></h3>
<p><strong>Source</strong>: Microsoft Research, <a href="https://github.com/guidance-ai/llguidance">guidance-ai/llguidance</a></p>
<p><strong>Key Contributions</strong>:
1. Efficient CFG grammar enforcement during decoding
2. Sub-100Î¼s token mask computation
3. Provider-agnostic integration</p>
<p><strong>MAZE Integration</strong>:
- Primary constraint enforcement mechanism
- Provider adapters leverage llguidance for all supported LLMs
- Performance characteristics validated by upstream benchmarks</p>
<p><strong>Status</strong>: Full integration complete</p>
<h3 id="related-work">Related Work<a class="headerlink" href="#related-work" title="Permanent link">&para;</a></h3>
<p><strong>OllamaHoles</strong> (Tritlo, GitHub): Inspired MAZE's typed hole approach</p>
<p><strong>Synchromesh</strong> (Poesia et al.): Grammar-based constrained generation (predecessor to llguidance)</p>
<p><strong>LMQL</strong> (Beurer-Kellner et al.): Query language for LLMs with constraints</p>
<p><strong>InCoder</strong> (Fried et al.): Fill-in-the-middle code generation</p>
<hr />
<h2 id="9-architecture-validation">9. Architecture Validation<a class="headerlink" href="#9-architecture-validation" title="Permanent link">&para;</a></h2>
<p>All claims in this whitepaper are validated against the codebase at tag <code>v0.1.0-whitepaper</code>.</p>
<h3 id="code-statistics">Code Statistics<a class="headerlink" href="#code-statistics" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Value</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr>
<td>Total source files</td>
<td>43</td>
<td><code>find src/maze -name "*.py" \| wc -l</code></td>
</tr>
<tr>
<td>Total source lines</td>
<td>10,847</td>
<td><code>find src/maze -name "*.py" -exec wc -l {} +</code></td>
</tr>
<tr>
<td>Test files</td>
<td>29</td>
<td><code>find tests -name "*.py" \| wc -l</code></td>
</tr>
<tr>
<td>Type system lines</td>
<td>2,124</td>
<td><code>wc -l src/maze/type_system/*.py</code></td>
</tr>
</tbody>
</table>
<h3 id="component-verification">Component Verification<a class="headerlink" href="#component-verification" title="Permanent link">&para;</a></h3>
<p><strong>Core Type System</strong> âœ…:
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/core/types.py">src/maze/core/types.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/core/constraints.py">src/maze/core/constraints.py</a></p>
<p><strong>Type System</strong> âœ… (2,124 lines):
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/inference.py">src/maze/type_system/inference.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/inhabitation.py">src/maze/type_system/inhabitation.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/holes.py">src/maze/type_system/holes.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/grammar_converter.py">src/maze/type_system/grammar_converter.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/type_system/languages/typescript.py">src/maze/type_system/languages/typescript.py</a></p>
<p><strong>Synthesis</strong> âœ…:
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/synthesis/grammar_builder.py">src/maze/synthesis/grammar_builder.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/synthesis/schema_builder.py">src/maze/synthesis/schema_builder.py</a></p>
<p><strong>Validation</strong> âœ…:
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/syntax.py">src/maze/validation/syntax.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/types.py">src/maze/validation/types.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/tests.py">src/maze/validation/tests.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/lint.py">src/maze/validation/lint.py</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/validation/pipeline.py">src/maze/validation/pipeline.py</a></p>
<p><strong>Integrations</strong> âœ…:
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/integrations/llguidance/">src/maze/integrations/llguidance/</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/integrations/mnemosyne/">src/maze/integrations/mnemosyne/</a>
- <a href="https://github.com/rand/maze/tree/v0.1.0-whitepaper/src/maze/integrations/rune/">src/maze/integrations/rune/</a></p>
<h3 id="git-commit-history">Git Commit History<a class="headerlink" href="#git-commit-history" title="Permanent link">&para;</a></h3>
<p><strong>Phase Completions</strong>:
- Phase 3 integration: <code>161b821</code> - "feat: Complete Phase 3 with integration and orchestration"
- Phase 3 sync: <code>a3fad53</code> - "chore: Sync Beads state after Phase 3 completion"</p>
<p><strong>Phase 4 Progress</strong>:
- SyntaxValidator: <code>013846c</code>
- TypeValidator: <code>a1b463c</code>
- TestValidator: <code>3f8f006</code>
- LintValidator: <code>7a91e04</code>
- RuneExecutor: <code>0e358b4</code>
- ValidationPipeline: <code>b4b31c6</code></p>
<h3 id="test-infrastructure">Test Infrastructure<a class="headerlink" href="#test-infrastructure" title="Permanent link">&para;</a></h3>
<p><strong>Test Organization</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>tests/
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>â”œâ”€â”€ unit/              # Component-level tests
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>â”œâ”€â”€ integration/       # Multi-component tests
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>â”œâ”€â”€ e2e/              # End-to-end scenarios
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>â””â”€â”€ conftest.py       # Pytest configuration
</span></code></pre></div></p>
<p><strong>Total test files</strong>: 29</p>
<h3 id="note-on-performance-claims">Note on Performance Claims<a class="headerlink" href="#note-on-performance-claims" title="Permanent link">&para;</a></h3>
<p>The CHANGELOG.md documents performance achievements:
- Token mask computation (p99): 50Î¼s
- Grammar compilation: 42ms
- Type error reduction: 94%
- Compilation success rate: 97%
- Memory usage: 600MB
- Cache hit rate: 89%</p>
<p><strong>Validation status</strong>: These metrics are documented but the benchmarks/ directory is currently empty. This whitepaper focuses on architectural design rather than specific performance numbers pending benchmark suite implementation.</p>
<hr />
<h2 id="10-getting-started">10. Getting Started<a class="headerlink" href="#10-getting-started" title="Permanent link">&para;</a></h2>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h3>
<p>MAZE requires Python 3.10+ and uses <code>uv</code> for dependency management:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># Clone repository</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rand/maze
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="nb">cd</span><span class="w"> </span>maze
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="c1"># Install dependencies</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;.[dev]&quot;</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1"># Verify installation</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>uv<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import maze; print(&#39;MAZE installed successfully&#39;)&quot;</span>
</span></code></pre></div>
<h3 id="basic-usage-conceptual">Basic Usage (Conceptual)<a class="headerlink" href="#basic-usage-conceptual" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze.core.constraints</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConstraintSet</span><span class="p">,</span> <span class="n">SyntacticConstraint</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze.type_system.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeContext</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">maze.orchestrator</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="c1"># 1. Define constraints</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="n">constraints</span> <span class="o">=</span> <span class="n">ConstraintSet</span><span class="p">()</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="c1"># Add syntactic constraint (TypeScript)</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="n">constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SyntacticConstraint</span><span class="o">.</span><span class="n">from_language</span><span class="p">(</span><span class="s2">&quot;typescript&quot;</span><span class="p">))</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="c1"># 2. Optionally add type context</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="n">type_context</span> <span class="o">=</span> <span class="n">TypeContext</span><span class="p">()</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="n">type_context</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="p">})</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="c1"># 3. Generate code</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="n">code</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Create an async function that fetches a user by ID and returns their email&quot;</span><span class="p">,</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>    <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">,</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>    <span class="n">type_context</span><span class="o">=</span><span class="n">type_context</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="p">)</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Expected output</strong> (with type constraints):
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getUserEmail</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchUser</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`User with ID </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb"> not found`</span><span class="p">);</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="p">}</span>
</span></code></pre></div></p>
<h3 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h3>
<p><strong>Explore the Documentation</strong>:
- <a href="../CLAUDE/">CLAUDE.md</a>: Comprehensive development guide
- <a href="../AGENT_GUIDE/">AGENT_GUIDE.md</a>: Operational workflows
- <a href="../whitepaper/validation-manifest/">Validation Manifest</a>: Code verification</p>
<p><strong>Contribute</strong>:
- GitHub: <a href="https://github.com/rand/maze">https://github.com/rand/maze</a>
- Issues: Report bugs, request features
- Pull Requests: Contribute code, documentation, benchmarks</p>
<p><strong>Learn More</strong>:
- Research papers: See <a href="#8-research-foundation">Section 8</a>
- Related projects: <a href="https://rand.github.io/mnemosyne">mnemosyne</a>, <a href="https://rand.github.io/RUNE">RUNE</a></p>
<hr />
<h2 id="11-conclusion">11. Conclusion<a class="headerlink" href="#11-conclusion" title="Permanent link">&para;</a></h2>
<h3 id="summary-of-contributions">Summary of Contributions<a class="headerlink" href="#summary-of-contributions" title="Permanent link">&para;</a></h3>
<p>MAZE introduces a novel approach to code generation that shifts from post-hoc validation to pre-generation constraint enforcement:</p>
<ol>
<li>
<p><strong>4-Tier Constraint Hierarchy</strong>: Progressive constraint tightening from syntax through types, semantics, and context</p>
</li>
<li>
<p><strong>Type-Directed Synthesis</strong>: Bidirectional type inference and inhabitation search for type-correct code paths</p>
</li>
<li>
<p><strong>Multi-System Integration</strong>: Seamless integration with llguidance (constraint enforcement), mnemosyne (persistent learning), RUNE (sandboxed validation), and pedantic_raven (quality enforcement)</p>
</li>
<li>
<p><strong>Research-Backed Design</strong>: Built on PLDI 2025 and OOPSLA 2024 research, validated through implementation</p>
</li>
<li>
<p><strong>Provider-Agnostic Architecture</strong>: Support for OpenAI, vLLM, SGLang, and llama.cpp through unified adapters</p>
</li>
</ol>
<h3 id="current-state-solid-foundation">Current State: Solid Foundation<a class="headerlink" href="#current-state-solid-foundation" title="Permanent link">&para;</a></h3>
<p>With 10,847 lines of code across 43 source files, MAZE has completed its core architectural foundation:</p>
<ul>
<li><strong>Phase 1-3</strong>: Type system, constraint synthesis, and core integrations complete</li>
<li><strong>Phase 4</strong>: Validation pipeline 60% complete (6/10 tasks)</li>
<li><strong>Phase 5-6</strong>: Adaptive learning and production hardening planned</li>
</ul>
<p>The implemented components demonstrate the viability of constraint-first generation and provide a foundation for the next generation of AI-assisted development tools.</p>
<h3 id="future-work">Future Work<a class="headerlink" href="#future-work" title="Permanent link">&para;</a></h3>
<p><strong>Short Term</strong> (Phase 4, Q4 2025):
- Complete repair orchestrator
- Diagnostic analyzer for intelligent constraint refinement
- Full pedantic_raven integration</p>
<p><strong>Medium Term</strong> (Phase 5, Q1 2026):
- Pattern mining from codebases
- Adaptive constraint learning
- Project-specific pattern adaptation</p>
<p><strong>Long Term</strong> (Phase 6, Q2 2026):
- Multi-language indexer completion (Python, Rust, Go, Zig)
- Comprehensive benchmark evaluation (HumanEval, MBPP, SWE-bench)
- IDE integrations (VSCode, IntelliJ)
- Production deployment optimization</p>
<h3 id="invitation-to-contribute">Invitation to Contribute<a class="headerlink" href="#invitation-to-contribute" title="Permanent link">&para;</a></h3>
<p>MAZE is developed as an open-source project. We welcome contributions in:</p>
<ul>
<li><strong>Benchmarking</strong>: Validate performance claims, run evaluations</li>
<li><strong>Language Support</strong>: Add indexers for Python, Rust, Go, Zig</li>
<li><strong>Constraint Synthesis</strong>: Improve grammar templates, type inference</li>
<li><strong>Testing</strong>: Expand test coverage, add property-based tests</li>
<li><strong>Documentation</strong>: Improve guides, add tutorials, create examples</li>
</ul>
<p>Visit <a href="https://github.com/rand/maze">github.com/rand/maze</a> to get started.</p>
<h3 id="acknowledgments">Acknowledgments<a class="headerlink" href="#acknowledgments" title="Permanent link">&para;</a></h3>
<p>MAZE builds on research by MÃ¼ndler et al. (PLDI 2025), Blinn et al. (OOPSLA 2024), and the Microsoft Research team behind llguidance. We gratefully acknowledge their foundational work in constrained generation and typed completion.</p>
<hr />
<h2 id="12-resources">12. Resources<a class="headerlink" href="#12-resources" title="Permanent link">&para;</a></h2>
<h3 id="project-links">Project Links<a class="headerlink" href="#project-links" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>GitHub Repository</strong>: <a href="https://github.com/rand/maze">github.com/rand/maze</a></li>
<li><strong>Documentation</strong>: <a href="../CLAUDE/">CLAUDE.md</a>, <a href="../AGENT_GUIDE/">AGENT_GUIDE.md</a></li>
<li><strong>Whitepaper</strong>: <a href="https://rand.github.io/maze">maze whitepaper</a></li>
</ul>
<h3 id="research-papers">Research Papers<a class="headerlink" href="#research-papers" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Type-Constrained Code Generation</strong>: <a href="https://arxiv.org/abs/2504.09246">arXiv:2504.09246</a> (PLDI 2025)</li>
<li><strong>Typed Holes</strong>: <a href="https://arxiv.org/abs/2409.00921">arXiv:2409.00921</a> (OOPSLA 2024)</li>
</ul>
<h3 id="related-projects">Related Projects<a class="headerlink" href="#related-projects" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>llguidance</strong>: <a href="https://github.com/guidance-ai/llguidance">github.com/guidance-ai/llguidance</a> (Microsoft Research)</li>
<li><strong>mnemosyne</strong>: <a href="https://rand.github.io/mnemosyne">rand.github.io/mnemosyne</a> (Memory &amp; Learning)</li>
<li><strong>RUNE</strong>: <a href="https://rand.github.io/RUNE">rand.github.io/RUNE</a> (Sandboxed Execution)</li>
</ul>
<h3 id="community">Community<a class="headerlink" href="#community" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Issues</strong>: <a href="https://github.com/rand/maze/issues">github.com/rand/maze/issues</a></li>
<li><strong>Discussions</strong>: <a href="https://github.com/rand/maze/discussions">github.com/rand/maze/discussions</a></li>
</ul>
<hr />
<p><strong>Version</strong>: v0.1.0-whitepaper
<strong>Last Updated</strong>: November 2025
<strong>License</strong>: [To be determined]</p>














                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-circle-arrow-up" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4M12 16V8"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Â© 2025
    </div>
  
  
    Made with
    <a href="https://zensical.org/" target="_blank" rel="noopener">
      Zensical
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      
      <script id="__config" type="application/json">{"annotate":null,"base":"../..","features":["navigation.instant","navigation.tabs","navigation.tracking","navigation.top","search.suggest","search.highlight","search.share"],"search":"../../assets/javascripts/workers/search.5e1f2129.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
    
    
      <script src="../../assets/javascripts/bundle.1193bd74.min.js"></script>
      
        <script src="../../javascripts/theme.js"></script>
      
    
  </body>
</html>